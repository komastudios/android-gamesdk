cmake_minimum_required(VERSION 3.4.1)
project(tuningfork-demo)

# If you have protobuf installed from a different directory, set it here. The source version
#  must match the protoc version.
set( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++14 -Werror -Wthread-safety" )
set( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -D _LIBCPP_ENABLE_THREAD_SAFETY_ANNOTATIONS -Os -fPIC" )
set( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fno-rtti" )
set( CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DGOOGLE_PROTOBUF_NO_RTTI -DHAVE_PTHREAD")

set( PROTOBUF_NANO_SRC_DIR "${CMAKE_CURRENT_LIST_DIR}/../../external/nanopb-c")

set( GAMESDK_BUILD_TUNINGFORK ON)
include("../../../gamesdk.cmake")

# This uses Tuningfork as a static library from the Game SDK package. Make sure the Android
# SDK and NDK versions that you are using are supported by the Game SDK.
add_gamesdk_target(PACKAGE_DIR "../../../../" BUILD_TYPE "Release")

include("../../../../src/protobuf/protobuf.cmake")

protobuf_generate_full_cpp( ${CMAKE_CURRENT_SOURCE_DIR}/src/main/proto src/main/proto/dev_tuningfork.proto)
protobuf_generate_full_cpp( ${CMAKE_CURRENT_SOURCE_DIR}/src/main/proto src/main/proto/tuningfork.proto)
include_directories(${PROTO_GENS_DIR})
include_directories(${PROTOBUF_SRC_DIR})
include_directories(${PROTOBUF_NANO_SRC_DIR})
include_directories(../../common)
include_directories(../../../../src)
include_directories(../../../common/include)
include_directories(../../../../include)

# Note that we use the FULL version of protobuf in the testapp, so we can get debug strings
add_library( protobuf-static
             STATIC
             ${PROTOBUF_LITE_SRCS}
             ${PROTOBUF_SRCS}
)
target_compile_options(protobuf-static PUBLIC "-Wno-tautological-constant-compare" "-Wno-enum-compare-switch")

add_library( ${CMAKE_PROJECT_NAME}
             SHARED
             src/main/cpp/experimentsdemo.cpp
             ../../common/Renderer.cpp
             ../../common/Scene.cpp
             ${PROTO_GENS_DIR}/full/dev_tuningfork.pb.cc
             ${PROTO_GENS_DIR}/full/tuningfork.pb.cc
)

target_link_libraries( ${CMAKE_PROJECT_NAME}
        swappy
        tuningfork
        protobuf-static
        android
        EGL
        GLESv2
        log
)
